# course-registration-api
時間割登録のAPI（DDD設計のチュートリアルとして作成）



## 設定

環境構築時はdocker-compose.ymlを参照した上で、env.sampleを参考に環境変数の設定をはじめに適宜行ってください。



## 共通事項

### エンドポイントプレフィックス

```
/api/v1
```



### エラー設計

#### ステータス

本APIで発生し得るエラーの一覧

| ステータスコード | エラー名              | 説明                                                         |
| ---------------- | --------------------- | ------------------------------------------------------------ |
| 400              | Bad Request           | 指定されたパラメータがAPIが受け付ける形式のものと異なるなどの不正がリクエスト中に存在する場合に返されます。 |
| 404              | Not Found             | 指定されたリソースが存在しない場合に返されます。             |
| 405              | Method Not Allowed    | 許可されていないHTTPメソッドを指定した場合に返されます。     |
| 500              | Internal Server Error | サーバ内部で何らかの実行時エラーが発生した場合に返されます。 |





## GET /health

### ヘルスチェック（APIの立ち上がり確認のみ）
#### リクエスト
```bash
$ curl -X GET '{プロトコル}://{ホスト}:{ポート}/api/v1/health'
```

#### レスポンス

正常にAPIが立ち上がっている場合にのみ以下のレスポンスを返します。

#### レスポンス（body）

```javascript
{
  "status":"up"
}
```



## GET /courses/<course_name>
### 指定した科目の時間割を取得

#### リクエストパラメータ

| パラメータ名 | 指定場所 | データ型 | 必須 | 説明   |
| ------------ | -------- | -------- | ---- | ------ |
| course_name  | Path     | str      | yes  | 科目名 |



#### リクエスト例
```bash
$ curl -X GET '{プロトコル}://{ホスト}:{ポート}/api/v1/courses/線形代数'
```

#### レスポンス（ステータスコード=200）

以下のキーから成るJSON

| キー名      | 型   | 説明   | 備考                                                   |
| ----------- | ---- | ------ | ------------------------------------------------------ |
| course_name | str  | 科目名 |                                                        |
| day_of_week | str  | 曜日   | "月", "火", "水", "木", "金", "土", "日"の何れかの文字 |
| period      | int  | 時限   | 1-8のいずれかの整数                                    |

#### レスポンス例（body）

```javascript
{
  "course_name": "線形代数", 
  "day_of_week": "月", 
  "period": 1
}
```

#### エラー

| エラーが生じる場面                   | エラーコード |
| ------------------------------------ | ------------ |
| 登録されていない科目名を指定した場合 | 404          |
| POSTメソッドを呼び出した場合         | 405          |



## GET/courses

### 全授業の時間割を取得

#### リクエスト

```bash
$ curl -X GET '{プロトコル}://{ホスト}:{ポート}/api/v1/courses
```

#### レスポンス例（body）

```javascript
{
  "月": [
    {
      "period": 1,
      "course_name": "線形代数"
    }, 
    {
      "period": 2,
      "course_name": "微分方程式"
    }
  ], 
  "火": [
    {
      "period": 3, 
      "course_name": "ミクロ"
    }
  ],
  "水": null
  "木": [
    {
      "period": 4, 
      "course_name": "マクロ"
    }
  ],
  "金" : [
    {
      "period": 5, 
      "course_name": "機械学習"
    }, 
    {
      "period": 7, 
      "course_name": "自然言語処理"
    }
  ],
  "土": [
    {
      "period": 6, 
      "couse_name": "体育"
    }
  ]
  "日": null
}
```

#### エラー

| エラーが生じる場面             | エラーコード |
| ------------------------------ | ------------ |
| PUTメソッドを呼び出した場合    | 405          |
| DELETEメソッドを呼び出した場合 | 405          |



## POST /courses

### 1件の新規科目の登録

#### Content-Type

```
application/json
```

#### リクエストパラメータ

| パラメータ名 | 指定場所 | データ型 | 必須 | 説明   |
| ------------ | -------- | -------- | ---- | ------ |
| course_name  | body     | str      | yes  | 科目名 |
| day_of_week  | body     | str      | yes  | 曜日   |
| period       | Body     | int      | yes  | 時限   |

#### リクエスト例

```bash
$ curl -X POST --header 'Content-Type: application/json' '{プロトコル}://{ホスト}:{ポート}/api/v1/courses' -d '{"course_name": "線形代数", "day_of_week": "月", "period": 1}'
```



#### レスポンス（ステータスコード）

- header

  ```
  Location: {プロトコル}://{ホスト}:{ポート}/api/v1/courses/線形代数
  ```

- body

  ```javascript
  {
    "course_name": "線形代数",
    "day_of_week": "月", 
    "period": 1
  }
  ```

#### エラー

| エラーが生じる場面                                   | エラーコード |
| ---------------------------------------------------- | ------------ |
| 既に登録済みの曜日・時限に科目を登録しようとした場合 | 400          |
| PUTメソッドを呼び出した場合                          | 405          |
| DELETEメソッドを呼び出した場合                       | 405          |



## PUT /courses/<course_name>
### 登録している科目情報の更新

#### Content-Type

```
application/json
```

#### リクエストパラメータ

| パラメータ名 | 指定する場所 | データ型 | 必須 | 説明   |
| ------------ | ------------ | -------- | ---- | ------ |
| couse_name   | path         | str      | yes  | 科目名 |
| day_of_week  | body         | str      | yes  | 曜日   |
| period       | body         | Int      | yes  | 時限   |

＊day_of_week または periodのいずれかは必須

#### リクエスト例

``` bash
$ curl -X PUT --header 'Content-Type: application/json' '{プロトコル}://{ホスト}:{ポート}/api/v1/線形代数' -d '{"day_of_week": "火", "period": 1}'
```

#### レスポンス（ステータスコード=202）

- header

  なし

- body

  なし

#### エラー

| エラーが生じる場面                                   | ステータスコード |
| ---------------------------------------------------- | ---------------- |
| 登録されていない科目名を指定した場合                 | 404              |
| 指定した曜日・時限に既に別の科目が登録されている場合 | 400              |
| POSTメソッドを呼び出した場合                         | 405              |

## DELETE /courses/<course_name>

### 指定した科目の登録を消去

#### リクエストパラメータ

| パラメータ名 | 指定場所 | データ型 | 必須 | 説明   |
| ------------ | -------- | -------- | ---- | ------ |
| course_name  | path     | str      | yes  | 科目名 |

#### リクエスト例

```bash
$ curl -X DELETE '{プロトコル}://{ホスト}:{ポート}/api/v1/線形代数'
```

#### エラー

| エラーが生じる場面                 | エラーコード |
| ---------------------------------- | ------------ |
| 登録されていない科目を指定した場合 | 404          |
| POSTメソッドを呼び出した場合       | 405          |

